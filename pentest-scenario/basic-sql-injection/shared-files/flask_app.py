from flask import Flask, request, session
import mysql.connector

app = Flask(__name__)

# MySQL Configuration
mysql_config = {
   "host": "192.168.56.3",
   "user": "myuser",
   "password": "4#j4TA-qNf5yj5M5^3D+",
   "database": "MonSite",
}

@app.route('/')
def frontend():
    conn = None
    cur = None
    try:
        conn = mysql.connector.connect(**mysql_config)
        cur = conn.cursor(dictionary=True)  # Use dictionary cursor
        cur.execute("SELECT * FROM MonSite.Users")
        rv = cur.fetchall()
        return str(rv)
    except Exception as e:
        return str(e)
    finally:
        if cur:
            cur.close()
        if conn:
            conn.close()

@app.route('/form', methods=['GET','POST'])
def form():
    if request.method == 'POST':
        email = request.form['email']
        password = request.form['password']

        conn = mysql.connector.connect(**mysql_config)
        cur = conn.cursor(dictionary=True)  # Use dictionary cursor
        cur.execute('SELECT * FROM Users WHERE Email = %s AND Pwd = %s;', (email,password))
        utilisateur = cur.fetchall()
        print(utilisateur)

        if len(utilisateur) > 0:
            return 'Connexion reussie !!!! Vos donn√©es:' + str(utilisateur)
        else:
            return 'Authentification Problem.'
        
    file = open("formulaire-connexion.html", 'r')
    contenu = file.read()
    file.close()
    return contenu

if __name__ == '__main__':
    app.run(host='0.0.0.0')

