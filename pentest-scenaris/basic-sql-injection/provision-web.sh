#!/bin/bash
# Mise à jour du système
sudo apt-get update
sudo apt-get upgrade -y

# Installez Python, Flask et d'autres dépendances
sudo apt-get install -y libmysqlclient-dev
sudo apt-get install -y python3 python3-pip
sudo pip3 install Flask
sudo pip3 install flask_mysqldb
sudo pip3 install SQLAlchemy

# Récupérer l'adresse IP à utiliser sur la machine hôte pour accéder au serveur Flask
ifconfig_output=$(ifconfig)
public_ips=$(echo "$ifconfig_output" | awk '/inet / && !/127.0.0.1/ && !/inet 10\./ {gsub(/addr:/, "", $2); print $2}' | tr -d '\n')
echo -n "$public_ips" > /vagrant/shared/serverIpAddr.txt

echo -e "\e[34mProvisionnement du serveur terminé\e[O"
# Arrêter le serveur Flask s'il est déjà en cours d'exécution
pkill -f "python3 /vagrant/shared/flask_app.py"
python3 /vagrant/shared/flask_app.py

